\# $project_description
\# Copyright (C) $year $copyright_holder
#echo '#\n# $' + 'Id$\n#\n'

import os.path

from zope.interface import classProvides

from twisted import plugin

import modu
from modu.web import app, static
from modu.editable import resource
from modu.editable.datatypes import fck

from ${project_name}.resource import index

class Site(object):
	classProvides(plugin.IPlugin, app.ISite)
	
	def configure_request(self, req):
		compiled_template_root = os.path.join(req.approot, 'var')
		if(os.path.exists(compiled_template_root)):
			req.app.config['compiled_template_root'] = compiled_template_root
	
	def initialize(self, application):
		application.base_domain = 'localhost'
		application.db_url = 'MySQLdb://$project_name@localhost/$project_name'
		
		import $project_name
		compiled_template_root = os.path.abspath(os.path.join(os.path.dirname(${project_name}.__file__), '../var'))
		if(os.path.exists(compiled_template_root)):
			application.compiled_template_root = compiled_template_root
		
		modu_assets_path = os.path.join(os.path.dirname(modu.__file__), 'assets')
		application.activate('/assets', static.FileResource, modu_assets_path)
		
		import ${project_name}.itemdefs
		application.activate('/admin', resource.AdminResource, default_listing='page', itemdef_module=${project_name}.itemdefs)
		
		application.activate('/fck', fck.FCKEditorResource)
		application.activate('/', index.Resource)
